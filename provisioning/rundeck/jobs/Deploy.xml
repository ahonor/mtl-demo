<joblist>
  <job>
    <loglevel>INFO</loglevel>
    <sequence keepgoing='false' strategy='node-first'>
      <command>
        <description>Run deploy script</description>
        <scriptargs>${option.version}</scriptargs>
        <script><![CDATA[#!/usr/bin/env bash
VERSION=$1

sleep 5

mtl attribute -n package:guitar -v ${VERSION}

echo "Updated to version: ${VERSION}"]]></script>
      </command>
      <command>
        <jobref name='stop' group='web' />
      </command>
      <command>
        <jobref name='start' group='web' />
      </command>
    </sequence>
    <description>the deploy the guitars app</description>
    <name>Deploy</name>
    <context>
      <options>
        <option name='version' values='1.0,1.1,2.0,2.1' enforcedvalues='true' required='true'>
          <description>the package version</description>
        </option>
      </options>
    </context>
    <dispatch>
      <threadcount>1</threadcount>
      <keepgoing>false</keepgoing>
      <excludePrecedence>true</excludePrecedence>
      <rankOrder>ascending</rankOrder>
    </dispatch>
    <nodefilters>
      <filter>tags: www</filter>
    </nodefilters>
    <group>release</group>
  </job>
</joblist>
